#!/bin/sh

export MYSQL_DATABASE="mp-test"
export MYSQL_ROOT_PASSWORD="test-root-password"
export MYSQL_USER="moneyprinter"
export MYSQL_PASSWORD="mp!QAZxsw2"

docker exec --tty $(docker-compose -f docker/docker-compose.yml ps -q db) mysql --user=$MYSQL_USER --password=$MYSQL_PASSWORD --database=$MYSQL_DATABASE --host=$MYSQL_HOST --execute="ALTER USER '$MYSQL_USER'@'%' IDENTIFIED WITH mysql_native_password BY '$MYSQL_PASSWORD'"
docker exec --tty $(docker-compose -f docker/docker-compose.yml ps -q api) /bin/bash -c "cd app && MP_ENVIRONMENT=test PYTHONPATH="$PYTHONPATH:/app" pytest ./tests"